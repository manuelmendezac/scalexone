<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BePartnex Landing</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; padding: 40px; }
    a { display: inline-block; margin: 20px; padding: 16px 32px; border-radius: 8px; text-decoration: none; font-size: 1.2em; }
    #whatsapp-button { background: #25d366; color: #fff; }
    #cta-button { background: #ffce00; color: #222; }
    .error-message { color: #ff4444; margin: 20px; }
    .success-message { color: #44ff44; margin: 20px; }
  </style>
</head>
<body>
  <h1>Bienvenido a BePartnex</h1>
  <a id="whatsapp-button" href="#" target="_blank">Contactar por WhatsApp</a>
  <a id="cta-button" href="#" target="_blank">Comprar ahora</a>

  <!-- Script mejorado para personalizar los enlaces -->
  <script>
    // Configuración de enlaces por defecto
    const CONFIG = {
      whatsapp: {
        numero: '51999999999', // Cambia por tu número
        mensajeBase: '¡Hola! Me gustaría más información sobre BePartnex.'
      },
      cta: {
        urlBase: 'https://tupago.com/checkout'
      }
    };

    // Función para logging
    function log(message, type = 'info') {
      console.log(`[BePartnex] ${message}`);
      if (type === 'error') {
        console.error(`[BePartnex] ${message}`);
      }
    }

    // Función para obtener parámetros de la URL
    function getQueryParam(param) {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const value = urlParams.get(param);
        log(`Parámetro ${param}: ${value}`);
        return value;
      } catch (error) {
        log(`Error al obtener parámetro ${param}: ${error.message}`, 'error');
        return null;
      }
    }

    // Función para validar el código de referencia
    function validarRef(ref) {
      const isValid = ref && ref.length >= 3 && /^[a-zA-Z0-9-_]+$/.test(ref);
      log(`Validación de ref ${ref}: ${isValid ? 'válido' : 'inválido'}`);
      return isValid;
    }

    // Función para actualizar enlaces
    function actualizarEnlaces(ref) {
      log(`Actualizando enlaces con ref: ${ref}`);
      
      // Actualizar WhatsApp
      const whatsappBtn = document.getElementById('whatsapp-button');
      if (whatsappBtn) {
        try {
          const mensaje = encodeURIComponent(`${CONFIG.whatsapp.mensajeBase} (Ref: ${ref})`);
          whatsappBtn.href = `https://wa.me/${CONFIG.whatsapp.numero}?text=${mensaje}`;
          log('Enlace de WhatsApp actualizado');
        } catch (error) {
          log(`Error al actualizar WhatsApp: ${error.message}`, 'error');
        }
      }

      // Actualizar CTA
      const ctaBtn = document.getElementById('cta-button');
      if (ctaBtn) {
        try {
          ctaBtn.href = `${CONFIG.cta.urlBase}?ref=${ref}`;
          log('Enlace CTA actualizado');
        } catch (error) {
          log(`Error al actualizar CTA: ${error.message}`, 'error');
        }
      }

      // Guardar el ref en localStorage
      try {
        localStorage.setItem('lastRef', ref);
        log('Ref guardado en localStorage');
      } catch (error) {
        log(`Error al guardar en localStorage: ${error.message}`, 'error');
      }
    }

    // Función para mostrar mensajes
    function mostrarMensaje(mensaje, tipo = 'error') {
      const div = document.createElement('div');
      div.className = tipo === 'error' ? 'error-message' : 'success-message';
      div.textContent = mensaje;
      document.body.appendChild(div);
      log(`Mensaje mostrado: ${mensaje}`, tipo);
    }

    // Inicialización cuando el DOM está listo
    document.addEventListener("DOMContentLoaded", function() {
      log('Iniciando personalización de landing');
      const ref = getQueryParam('ref');
      
      if (ref && validarRef(ref)) {
        actualizarEnlaces(ref);
        mostrarMensaje('Landing personalizada correctamente', 'success');
      } else {
        // Intentar recuperar el último ref usado
        try {
          const lastRef = localStorage.getItem('lastRef');
          if (lastRef && validarRef(lastRef)) {
            actualizarEnlaces(lastRef);
            mostrarMensaje('Usando último código de referencia', 'success');
          } else {
            mostrarMensaje('Código de referencia no válido o no proporcionado');
          }
        } catch (error) {
          log(`Error al recuperar último ref: ${error.message}`, 'error');
          mostrarMensaje('Error al cargar la personalización');
        }
      }
    });
  </script>
</body>
</html> 